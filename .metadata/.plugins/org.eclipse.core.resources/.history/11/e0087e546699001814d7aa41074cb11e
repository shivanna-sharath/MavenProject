import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class Que {

	public static void main(String[] args) throws SQLException, ClassNotFoundException {
		// TODO Auto-generated method stub

		Connection con = null;

		Class.forName("com.mysql.jdbc.Driver");

		con = DriverManager.getConnection("jdbc:mysql://localhost:3306/diagnostic_centre", "root", "Welcome123");

		String var1 = "ramesh@gmail.com";
		String var2 = "99000125";
		String var3 = "02-02-2018";
		String dat = var3.substring(6) + "-" + var3.substring(3, 5) + "-" + var3.substring(0, 2);
		Statement stmt1 = con.createStatement();
		ResultSet rs;
		ResultSet rss;
		ResultSet rs2, rs1;

		Statement stmt2 = con.createStatement();

		String query = "SELECT * FROM pATIENT_TEST WHERE DATE='" + dat + "'";

		rs = stmt1.executeQuery(query);

		if (rs.next()) {
			String query1 = "SELECT * FROM PATIENT WHERE EMAIL='" + var1 + "' or phone='" + var2 + "'";
			rss = stmt1.executeQuery(query1);
			System.out.println("Personal Details");
			while (rss.next()) {
				System.out.print(rss.getString(1));
				System.out.print(" " + rss.getString(2));
				System.out.print(" " + rss.getString(3));
				System.out.println(" " + rss.getString(4));

			}

			String query11 = "SELECT TID,COUNT(TID) FROM PATIENT_TEST WHERE DATE='" + dat
					+ "' AND PID IN(SELECT PID FROM PATIENT WHERE EMAIL='" + var1 + "'or phone='" + var2
					+ "') GROUP BY TID";
			rs1 = stmt1.executeQuery(query11);

			System.out.println("\tTest details:");
			System.out.println();
			System.out.println("\tTest \t\t Cost");
			String xxx = "";

			
			while (rs1.next()) {
				int count = rs1.getInt(2);
				int tid = rs1.getInt(1);
				
				String query2 = "SELECT T.NAME,T.COST FROM TEST T WHERE T.T_ID='" + tid + "'";
				rs2 = stmt2.executeQuery(query2);

				while (rs2.next()) {

					System.out.println("\t" + rs2.getString(1) + "\t\t" + count * rs2.getInt(2));
					// return (("\t" + rs2.getString(1) + "\t\t" + count * rs2.getInt(2)));
				}
				
			}
		}

		else {
			System.out.println("not present");
		}
	}
}
